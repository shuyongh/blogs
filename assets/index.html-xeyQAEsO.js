import{_ as a,c as o,a as r,o as n}from"./app-C7T5jqfQ.js";const t={};function c(p,e){return n(),o("div",null,e[0]||(e[0]=[r('<p>流是由形成 HTTP 请求/响应对的消息组成的集合。</p><p>流这个词来自 HTTP/2。在 Cowboy 中，它在谈论 HTTP/1.1 或 HTTP/1.0 时也会使用。它不应与请求或响应体的流式传输混淆。</p><p>所有版本的 HTTP 都允许客户端发起流。只有 HTTP/2 还允许服务器通过其服务器推送功能发起流。客户端和服务器发起的流在 Cowboy 中都经过相同的过程。</p><h2 id="流处理器" tabindex="-1"><a class="header-anchor" href="#流处理器"><span>流处理器</span></a></h2><p>Stream 处理器必须实现五个不同的回调函数。其中四个是直接相关的；一个是特殊的。</p><p>所有的回调函数都以流 ID 作为第一个参数。</p><p>其中大多数可以返回一个命令列表，由 Cowboy 执行。当回调函数被链接时，可以拦截和修改这些命令。例如，这可以用于修改响应。</p><p><code>init/3</code> 回调函数在接收到新请求时被调用。它接收 Req 对象和此监听器的协议选项。</p><p>The <code>data/4</code> 回调在接收到请求主体的数据时被调用。它接收数据本身以及一个指示是否还有更多数据要接收的标志。</p><p>The <code>info/3</code> 回调在接收到此流的 Erlang 消息时被调用。这些消息通常是由请求进程发送的消息。</p><p>最后，<code>terminate/3</code> 回调以流的终止原因作为参数被调用。返回值会被忽略。请注意，与所有 Erlang 的终止回调一样，没有强烈的保证它会被调用。</p><p>特殊回调 <code>early_error/5</code> 在 Cowboy 在发送响应之前接收到请求头不完整时被调用。它接收部分 Req 对象、错误原因、协议选项以及 Cowboy 将要发送的响应。此响应必须被返回，可能被修改。</p><h2 id="内置处理器" tabindex="-1"><a class="header-anchor" href="#内置处理器"><span>内置处理器</span></a></h2><p>Cowboy 包含四个处理器。</p><p><a href="https://ninenines.eu/docs/en/cowboy/2.13/manual/cowboy_stream_h" target="_blank" rel="noopener noreferrer">cowboy_stream_h</a> 是默认的流处理器。它是 Cowboy 的许多功能的核心。所有流处理器链都应最后调用它。</p><p><a href="https://ninenines.eu/docs/en/cowboy/2.13/manual/cowboy_compress_h" target="_blank" rel="noopener noreferrer">cowboy_compress_h</a> 可以在可能的情况下自动压缩响应。它默认未启用。它是编写自己的可以修改响应的处理器的一个很好的例子。</p><p><a href="https://ninenines.eu/docs/en/cowboy/2.13/manual/cowboy_decompress_h" target="_blank" rel="noopener noreferrer">cowboy_decompress_h</a> 会在可能的情况下自动解压缩请求正文。它默认未启用。它是一个很好的例子，说明了如何编写会修改请求的自己的处理器。</p><p><a href="https://ninenines.eu/docs/en/cowboy/2.13/manual/cowboy_metrics_h" target="_blank" rel="noopener noreferrer">cowboy_metrics_h</a> 会收集流的指标，然后将它们传递给可配置的功能。它默认未启用。</p><p><a href="https://ninenines.eu/docs/en/cowboy/2.13/manual/cowboy_tracer_h" target="_blank" rel="noopener noreferrer">cowboy_tracer_h</a> 可以根据请求的内容或其来源有条件地跟踪流。跟踪事件将传递给可配置的功能。它默认未启用。</p>',19)]))}const d=a(t,[["render",c]]),h=JSON.parse('{"path":"/backend/erlang/45pqeohj/","title":"stream","lang":"zh-CN","frontmatter":{"title":"stream","createTime":"2025/03/28 11:47:15","permalink":"/backend/erlang/45pqeohj/"},"headers":[],"readingTime":{"minutes":2.29,"words":688},"git":{"updatedTime":1743158971000,"contributors":[{"name":"syh","username":"syh","email":"syh@qq.com","commits":1,"avatar":"https://gravatar.com/avatar/060d67e779a1b0aeace68a2a010b367f852e56888393383ea27302df983f6814?d=retro"}]},"filePathRelative":"notes/backend/erlang/rebar3/cowboy/advanced/stream.md"}');export{d as comp,h as data};
