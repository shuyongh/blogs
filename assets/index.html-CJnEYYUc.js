import{_ as i,c as t,a,o as e}from"./app-C7T5jqfQ.js";const l={};function n(h,s){return e(),t("div",null,s[0]||(s[0]=[a(`<h2 id="监督树生命周期管理" tabindex="-1"><a class="header-anchor" href="#监督树生命周期管理"><span><strong>监督树生命周期管理</strong></span></a></h2><table><thead><tr><th style="text-align:left;"><strong>启动应用</strong></th><th style="text-align:left;"><strong>不启动应用</strong></th></tr></thead><tbody><tr><td style="text-align:left;">创建完整的监督树，自动管理进程生命周期</td><td style="text-align:left;">只能使用模块函数，无法自动管理进程</td></tr><tr><td style="text-align:left;">崩溃时会按监督策略重启子进程</td><td style="text-align:left;">进程崩溃后不会自动恢复</td></tr><tr><td style="text-align:left;">停止应用时会按顺序终止所有关联进程</td><td style="text-align:left;">需要手动管理进程的创建和销毁</td></tr></tbody></table><p><strong>示例</strong>：</p><div class="language-erlang line-numbers-mode" data-highlighter="shiki" data-ext="erlang" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">% 启动应用时，其监控树自动建立</span></span>
<span class="line"><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">application</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">start</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">crypto</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">. </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">% 不启动应用时，直接调用模块函数可能失败</span></span>
<span class="line"><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">crypto</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">hash</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">sha256</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">data</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.  </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">% 可能因未初始化而报错</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置和环境变量" tabindex="-1"><a class="header-anchor" href="#配置和环境变量"><span><strong>配置和环境变量</strong></span></a></h2><table><thead><tr><th style="text-align:left;"><strong>启动应用</strong></th><th style="text-align:left;"><strong>不启动应用</strong></th></tr></thead><tbody><tr><td style="text-align:left;">自动加载 <code>sys.config</code> 中的配置</td><td style="text-align:left;">需要手动设置应用环境变量</td></tr><tr><td style="text-align:left;">可通过 <code>application:get_env/2</code> 获取配置</td><td style="text-align:left;">配置系统不可用</td></tr><tr><td style="text-align:left;">支持运行时配置更新</td><td style="text-align:left;">配置静态不可变</td></tr></tbody></table><p><strong>示例</strong>：</p><div class="language-erlang line-numbers-mode" data-highlighter="shiki" data-ext="erlang" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">% 启动应用后才能获取配置</span></span>
<span class="line"><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">application</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">get_env</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">mnesia</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> dir</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.  </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">% 返回 {ok, &quot;/data&quot;}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">% 不启动时需硬编码配置</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">MnesiaDir</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/data</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.  </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">% 失去灵活性</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="依赖管理" tabindex="-1"><a class="header-anchor" href="#依赖管理"><span><strong>依赖管理</strong></span></a></h2><table><thead><tr><th style="text-align:left;"><strong>启动应用</strong></th><th style="text-align:left;"><strong>不启动应用</strong></th></tr></thead><tbody><tr><td style="text-align:left;">自动解决依赖关系（按 <code>.app</code> 文件中的声明）</td><td style="text-align:left;">需手动确保所有依赖可用</td></tr><tr><td style="text-align:left;">保证依赖应用的启动顺序</td><td style="text-align:left;">可能因加载顺序导致运行时错误</td></tr><tr><td style="text-align:left;">支持 <code>optional_applications</code></td><td style="text-align:left;">需要自行处理可选依赖</td></tr></tbody></table><p><strong>典型问题</strong>：</p><div class="language-erlang line-numbers-mode" data-highlighter="shiki" data-ext="erlang" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">% 假设application_a依赖application_b</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">% 正确方式（自动处理依赖）：</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">applications</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">application_b</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]}</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">% 直接使用模块可能导致：</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">% 在application_b初始化完成前调用其函数 → 崩溃</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="热代码升级" tabindex="-1"><a class="header-anchor" href="#热代码升级"><span><strong>热代码升级</strong></span></a></h2><table><thead><tr><th style="text-align:left;"><strong>启动应用</strong></th><th style="text-align:left;"><strong>不启动应用</strong></th></tr></thead><tbody><tr><td style="text-align:left;">支持完整的 <code>.appup</code> 升级脚本</td><td style="text-align:left;">无法进行合规的热代码交换</td></tr><tr><td style="text-align:left;">自动处理模块版本切换</td><td style="text-align:left;">需手动管理代码加载</td></tr><tr><td style="text-align:left;">保证升级过程的事务性</td><td style="text-align:left;">可能造成版本不一致</td></tr></tbody></table><h2 id="资源初始化" tabindex="-1"><a class="header-anchor" href="#资源初始化"><span><strong>资源初始化</strong></span></a></h2><table><thead><tr><th style="text-align:left;"><strong>启动应用</strong></th><th style="text-align:left;"><strong>不启动应用</strong></th></tr></thead><tbody><tr><td style="text-align:left;">自动执行 <code>Application:start/2</code> 回调</td><td style="text-align:left;">需要手动初始化资源</td></tr><tr><td style="text-align:left;">可执行数据库连接、端口驱动等初始化操作</td><td style="text-align:left;">可能因未初始化导致功能异常</td></tr><tr><td style="text-align:left;">支持优雅的停止和清理</td><td style="text-align:left;">资源泄漏风险高</td></tr></tbody></table><p><strong>典型案例</strong>：</p><div class="language-erlang line-numbers-mode" data-highlighter="shiki" data-ext="erlang" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">% 启动应用时初始化ETS表</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">module</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">my_app</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">).</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">start</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">_Type</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">_Args</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -&gt;</span></span>
<span class="line"><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">    ets</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">new</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">my_table</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">named_table</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> public</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]),</span></span>
<span class="line"><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">    supervisor</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">start_link</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">% 不启动应用直接使用ETS：</span></span>
<span class="line"><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">ets</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">new</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">my_table</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">])</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.  </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">% 需要确保只创建一次</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="分布式协调" tabindex="-1"><a class="header-anchor" href="#分布式协调"><span><strong>分布式协调</strong></span></a></h2><table><thead><tr><th style="text-align:left;"><strong>启动应用</strong></th><th style="text-align:left;"><strong>不启动应用</strong></th></tr></thead><tbody><tr><td style="text-align:left;">自动参与分布式启动协调</td><td style="text-align:left;">无法加入集群启动序列</td></tr><tr><td style="text-align:left;">支持 <code>sync_nodes</code> 等特性</td><td style="text-align:left;">分布式协同困难</td></tr><tr><td style="text-align:left;">可被 <code>release_handler</code> 管理</td><td style="text-align:left;">脱离OTP发布管理</td></tr></tbody></table><h2 id="何时可以不启动应用" tabindex="-1"><a class="header-anchor" href="#何时可以不启动应用"><span>何时可以不启动应用？</span></a></h2><p>仅在以下情况考虑直接使用模块：</p><ol><li><strong>纯工具库</strong>（如 <code>lists</code>, <code>maps</code> 等无状态模块）</li><li><strong>临时调试</strong>时快速测试函数</li><li><strong>特殊优化场景</strong>（需谨慎评估）</li></ol><hr><h2 id="最佳实践建议" tabindex="-1"><a class="header-anchor" href="#最佳实践建议"><span>最佳实践建议</span></a></h2><ol><li><p><strong>对任何有状态的模块</strong>（如进程、ETS、端口等），必须通过应用启动</p></li><li><p><strong>生产环境</strong>始终使用 <code>application:ensure_all_started/1</code></p></li><li><p><strong>开发时</strong>可用以下模式快速测试：</p><div class="language-erlang line-numbers-mode" data-highlighter="shiki" data-ext="erlang" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">% 测试时确保环境</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">ok</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> _</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> =</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> application</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ensure_all_started</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">deps</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">my_module</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">test</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol>`,26)]))}const r=i(l,[["render",n]]),k=JSON.parse('{"path":"/article/ygy23h2f/","title":"是否显式启动一个应用程序的区别","lang":"zh-CN","frontmatter":{"title":"是否显式启动一个应用程序的区别","createTime":"2025/04/28 18:14:55","permalink":"/article/ygy23h2f/","tags":["erlang","application"]},"headers":[],"readingTime":{"minutes":2.74,"words":823},"git":{"updatedTime":1745841107000,"contributors":[{"name":"syh","username":"syh","email":"syh@qq.com","commits":1,"avatar":"https://gravatar.com/avatar/060d67e779a1b0aeace68a2a010b367f852e56888393383ea27302df983f6814?d=retro"}]},"filePathRelative":"blog/后端/start_application.md","categoryList":[{"id":"126ac9","sort":10004,"name":"blog"},{"id":"4ad65e","sort":10005,"name":"后端"}]}');export{r as comp,k as data};
